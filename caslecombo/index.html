<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎßàÌÅ¨ÏΩ§Î≥¥ - MineCombo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Noto+Sans+KR:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --emerald: #2ecc71;
            --emerald-dark: #27ae60;
            --pearl: #9b59b6;
            --pearl-dark: #8e44ad;
            --cave-bg: #2c3e50;
            --surface-bg: #87ceeb;
            --stone: #7f8c8d;
            --dirt: #8B4513;
            --grass: #228B22;
            --diamond: #00d4ff;
            --gold: #ffd700;
            --iron: #c0c0c0;
            --redstone: #ff4444;
            --lapis: #2244ff;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(180deg, #87ceeb 0%, #87ceeb 50%, #3d2817 50%, #2c2c2c 100%);
            min-height: 100vh;
            padding: 20px;
            background-attachment: fixed;
        }
        
        h1 {
            font-family: 'VT323', monospace;
            text-align: center;
            font-size: 3rem;
            color: #fff;
            text-shadow: 4px 4px 0 #000, -2px -2px 0 #000;
            margin-bottom: 20px;
            letter-spacing: 4px;
        }
        
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .market-section {
            background: rgba(0,0,0,0.7);
            border: 4px solid #555;
            border-radius: 8px;
            padding: 15px;
            image-rendering: pixelated;
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #444;
        }
        
        .market-title {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .market-title.cave { color: var(--diamond); }
        .market-title.surface { color: var(--grass); }
        
        .minecart {
            background: #8B4513;
            color: #fff;
            padding: 5px 15px;
            border-radius: 4px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            border: 3px solid #5d3a1a;
            box-shadow: inset 0 -3px 0 #5d3a1a;
        }
        
        .market-cards {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .card {
            width: 140px;
            height: 200px;
            background: linear-gradient(145deg, #f5f5dc 0%, #ddd5c0 100%);
            border: 3px solid #333;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            font-size: 0.75rem;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        
        .card.cave-card {
            background: linear-gradient(145deg, #4a5568 0%, #2d3748 100%);
            color: #fff;
        }
        
        .card.surface-card {
            background: linear-gradient(145deg, #68d391 0%, #48bb78 100%);
            color: #1a202c;
        }
        
        .card-cost {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--emerald);
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            border: 2px solid var(--emerald-dark);
        }
        
        .card-symbol {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.2rem;
        }
        
        .card-image {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-top: 25px;
        }
        
        .card-name {
            text-align: center;
            font-weight: bold;
            font-size: 0.85rem;
            margin: 5px 0;
            font-family: 'VT323', monospace;
            letter-spacing: 1px;
        }
        
        .card-effect {
            font-size: 0.65rem;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 3px;
        }
        
        .card-effect .instant {
            color: #f6e05e;
            background: rgba(0,0,0,0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .card-effect .endgame {
            color: #90cdf4;
        }
        
        .card-chest {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 0.7rem;
            background: #8B4513;
            padding: 2px 6px;
            border-radius: 3px;
            color: #fff;
        }
        
        .card.flipped {
            background: linear-gradient(145deg, #718096 0%, #4a5568 100%) !important;
        }
        
        .card.flipped .card-image {
            font-size: 3rem;
        }
        
        .card.flipped::after {
            content: 'Ï°∞ÏïΩÎèå';
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'VT323', monospace;
            color: #a0aec0;
        }
        
        .player-area {
            background: rgba(139,69,19,0.9);
            border: 4px solid #5d3a1a;
            border-radius: 8px;
            padding: 15px;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-name {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: #fff;
        }
        
        .player-resources {
            display: flex;
            gap: 15px;
        }
        
        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0,0,0,0.5);
            padding: 5px 12px;
            border-radius: 4px;
            color: #fff;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
        }
        
        .resource.emerald { border: 2px solid var(--emerald); }
        .resource.pearl { border: 2px solid var(--pearl); }
        
        .tableau {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 450px;
        }
        
        .tableau-slot {
            aspect-ratio: 7/10;
            background: rgba(0,0,0,0.4);
            border: 2px dashed #666;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 2rem;
        }
        
        .tableau-slot.has-card {
            border: none;
            padding: 0;
        }
        
        .tableau-slot .card {
            width: 100%;
            height: 100%;
            margin: 0;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .info-panel {
            background: rgba(0,0,0,0.8);
            border: 3px solid #444;
            border-radius: 8px;
            padding: 15px;
            color: #fff;
        }
        
        .info-panel h3 {
            font-family: 'VT323', monospace;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--gold);
            border-bottom: 2px solid #444;
            padding-bottom: 5px;
        }
        
        .turn-info {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .action-btn {
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .action-btn:hover:not(:disabled) {
            transform: scale(1.02);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-btn.primary {
            background: linear-gradient(180deg, var(--emerald) 0%, var(--emerald-dark) 100%);
            color: #fff;
            border: 3px solid var(--emerald-dark);
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3);
        }
        
        .action-btn.secondary {
            background: linear-gradient(180deg, var(--pearl) 0%, var(--pearl-dark) 100%);
            color: #fff;
            border: 3px solid var(--pearl-dark);
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3);
        }
        
        .action-btn.danger {
            background: linear-gradient(180deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            border: 3px solid #c0392b;
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3);
        }
        
        .score-display {
            font-size: 2rem;
            text-align: center;
            color: var(--gold);
            font-family: 'VT323', monospace;
        }
        
        .log {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
            color: #aaa;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #333;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #2d3748 0%, #1a202c 100%);
            border: 4px solid var(--gold);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            color: #fff;
        }
        
        .modal-content h2 {
            font-family: 'VT323', monospace;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 20px;
        }
        
        .final-score {
            font-size: 4rem;
            font-family: 'VT323', monospace;
            color: var(--emerald);
            margin: 20px 0;
        }
        
        .score-breakdown {
            text-align: left;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .score-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
        
        .placement-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 15px 30px;
            border-radius: 8px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            border: 2px solid var(--emerald);
            z-index: 100;
            display: none;
        }
        
        .placement-hint.active {
            display: block;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .tableau-slot.valid-placement {
            border-color: var(--emerald);
            background: rgba(46, 204, 113, 0.2);
            cursor: pointer;
        }
        
        .tableau-slot.valid-placement:hover {
            background: rgba(46, 204, 113, 0.4);
        }
        
        .selected-card-preview {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            display: none;
        }
        
        .selected-card-preview.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>‚õèÔ∏è ÎßàÌÅ¨ÏΩ§Î≥¥ MINECOMBO ‚õèÔ∏è</h1>
    
    <div class="game-container">
        <div class="main-area">
            <!-- ÎèôÍµ¥ ÎßàÏºì -->
            <div class="market-section">
                <div class="market-header">
                    <div class="market-title cave">‚õèÔ∏è ÎèôÍµ¥ CAVE</div>
                    <div class="minecart" id="minecart-cave" style="display:none">üöÉ Í¥ëÏÇ∞ÏàòÎ†à</div>
                </div>
                <div class="market-cards" id="cave-market"></div>
            </div>
            
            <!-- ÏßÄÏÉÅ ÎßàÏºì -->
            <div class="market-section">
                <div class="market-header">
                    <div class="market-title surface">üå≤ ÏßÄÏÉÅ SURFACE</div>
                    <div class="minecart" id="minecart-surface">üöÉ Í¥ëÏÇ∞ÏàòÎ†à</div>
                </div>
                <div class="market-cards" id="surface-market"></div>
            </div>
            
            <!-- ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ -->
            <div class="player-area">
                <div class="player-header">
                    <div class="player-name">üéÆ ÎÇ¥ ÏòÅÏó≠</div>
                    <div class="player-resources">
                        <div class="resource emerald">üíé <span id="emerald-count">15</span></div>
                        <div class="resource pearl">üîÆ <span id="pearl-count">2</span></div>
                    </div>
                </div>
                <div class="tableau" id="player-tableau"></div>
            </div>
        </div>
        
        <div class="sidebar">
            <div class="info-panel">
                <h3>üìä Í≤åÏûÑ Ï†ïÎ≥¥</h3>
                <div class="turn-info">ÌÑ¥: <span id="turn-count">1</span> / 9</div>
                <div class="score-display" id="current-score">0Ï†ê</div>
            </div>
            
            <div class="info-panel">
                <h3>üéØ ÌñâÎèô</h3>
                <div class="actions">
                    <button class="action-btn secondary" id="btn-move-minecart" onclick="moveMinecart()">
                        üîÆ Í¥ëÏÇ∞ÏàòÎ†à Ïù¥Îèô (-1 ÏßÑÏ£º)
                    </button>
                    <button class="action-btn secondary" id="btn-refresh" onclick="refreshMarket()">
                        üîÆ ÎßàÏºì Î¶¨ÌîÑÎ†àÏãú (-1 ÏßÑÏ£º)
                    </button>
                    <button class="action-btn danger" id="btn-flip" onclick="toggleFlipMode()">
                        ü™® Ï°∞ÏïΩÎèåÎ°ú Î≥ÄÌôò
                    </button>
                    <button class="action-btn primary" onclick="newGame()">
                        üîÑ ÏÉà Í≤åÏûÑ
                    </button>
                </div>
            </div>
            
            <div class="info-panel">
                <h3>üìú Í∏∞Î°ù</h3>
                <div class="log" id="game-log"></div>
            </div>
        </div>
    </div>
    
    <div class="placement-hint" id="placement-hint">
        Ïπ¥ÎìúÎ•º ÎÜìÏùÑ ÏúÑÏπòÎ•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî
    </div>
    
    <div class="selected-card-preview" id="selected-preview"></div>
    
    <div class="modal" id="game-over-modal">
        <div class="modal-content">
            <h2>üèÜ Í≤åÏûÑ Ï¢ÖÎ£å!</h2>
            <div class="final-score" id="final-score">0</div>
            <div class="score-breakdown" id="score-breakdown"></div>
            <button class="action-btn primary" onclick="newGame()">Îã§Ïãú ÌïòÍ∏∞</button>
        </div>
    </div>

    <script>
        // Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞
        const CAVE_CARDS = [
            // Í¥ëÏÑù (12Ïû•)
            { id: 'diamond', name: 'Îã§Ïù¥ÏïÑÎ™¨Îìú', emoji: 'üíé', cost: 5, symbol: '‚õèÔ∏è', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'Ïù∏Ï†ë ‚õèÔ∏èÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, '‚õèÔ∏è') * 2, chest: 3 },
            { id: 'diamond2', name: 'Îã§Ïù¥ÏïÑÎ™¨Îìú', emoji: 'üíé', cost: 5, symbol: '‚õèÔ∏è', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'Ïù∏Ï†ë ‚õèÔ∏èÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, '‚õèÔ∏è') * 2, chest: 3 },
            { id: 'emerald_ore', name: 'ÏóêÎ©îÎûÑÎìú Í¥ëÏÑù', emoji: 'üíö', cost: 4, symbol: '‚õèÔ∏è', instant: '+3 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 3, endgame: 'Í∏∞Î≥∏ 3Ï†ê', score: () => 3, chest: 2 },
            { id: 'emerald_ore2', name: 'ÏóêÎ©îÎûÑÎìú Í¥ëÏÑù', emoji: 'üíö', cost: 4, symbol: '‚õèÔ∏è', instant: '+3 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 3, endgame: 'Í∏∞Î≥∏ 3Ï†ê', score: () => 3, chest: 2 },
            { id: 'redstone', name: 'Î†àÎìúÏä§ÌÜ§', emoji: 'üî¥', cost: 3, symbol: '‚õèÔ∏è', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'üîß 1Í∞úÎãπ +2Ï†ê', score: (g) => countSymbol(g, 'üîß') * 2, chest: 1 },
            { id: 'redstone2', name: 'Î†àÎìúÏä§ÌÜ§', emoji: 'üî¥', cost: 3, symbol: '‚õèÔ∏è', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'üîß 1Í∞úÎãπ +2Ï†ê', score: (g) => countSymbol(g, 'üîß') * 2, chest: 1 },
            { id: 'lapis', name: 'Ï≤≠Í∏àÏÑù', emoji: 'üîµ', cost: 3, symbol: '‚õèÔ∏è', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: '‚õèÔ∏è 3Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, '‚õèÔ∏è') >= 3 ? 5 : 0, chest: 2 },
            { id: 'lapis2', name: 'Ï≤≠Í∏àÏÑù', emoji: 'üîµ', cost: 3, symbol: '‚õèÔ∏è', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: '‚õèÔ∏è 3Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, '‚õèÔ∏è') >= 3 ? 5 : 0, chest: 2 },
            { id: 'gold_ore', name: 'Í∏à Í¥ëÏÑù', emoji: 'üü°', cost: 4, symbol: '‚õèÔ∏è', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ïó¥ ‚õèÔ∏èÎãπ +2Ï†ê', score: (g, pos) => countInColumn(g, pos, '‚õèÔ∏è') * 2, chest: 3 },
            { id: 'gold_ore2', name: 'Í∏à Í¥ëÏÑù', emoji: 'üü°', cost: 4, symbol: '‚õèÔ∏è', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ïó¥ ‚õèÔ∏èÎãπ +2Ï†ê', score: (g, pos) => countInColumn(g, pos, '‚õèÔ∏è') * 2, chest: 3 },
            { id: 'iron_ore', name: 'Ï≤† Í¥ëÏÑù', emoji: '‚ö™', cost: 2, symbol: '‚õèÔ∏è', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 1 },
            { id: 'iron_ore2', name: 'Ï≤† Í¥ëÏÑù', emoji: '‚ö™', cost: 2, symbol: '‚õèÔ∏è', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 1 },
            
            // ÎèôÍµ¥ Î™π (10Ïû•)
            { id: 'creeper', name: 'ÌÅ¨Î¶¨Ìçº', emoji: 'üíÄ', cost: 3, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 3Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, 'üëπ') >= 3 ? 5 : 0, chest: 0 },
            { id: 'creeper2', name: 'ÌÅ¨Î¶¨Ìçº', emoji: 'üíÄ', cost: 3, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 3Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, 'üëπ') >= 3 ? 5 : 0, chest: 0 },
            { id: 'zombie', name: 'Ï¢ÄÎπÑ', emoji: 'üßü', cost: 2, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üëπ') / 2) * 2, chest: 0 },
            { id: 'zombie2', name: 'Ï¢ÄÎπÑ', emoji: 'üßü', cost: 2, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üëπ') / 2) * 2, chest: 0 },
            { id: 'skeleton', name: 'Ïä§ÏºàÎ†àÌÜ§', emoji: 'üíÄ', cost: 2, symbol: 'üëπ', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'skeleton2', name: 'Ïä§ÏºàÎ†àÌÜ§', emoji: 'üíÄ', cost: 2, symbol: 'üëπ', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'spider', name: 'Í±∞ÎØ∏', emoji: 'üï∑Ô∏è', cost: 2, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ïù∏Ï†ë üëπÎãπ +1Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üëπ') * 1, chest: 0 },
            { id: 'slime', name: 'Ïä¨ÎùºÏûÑ', emoji: 'üü¢', cost: 1, symbol: 'üëπ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'warden', name: 'ÏõåÎì†', emoji: 'üëæ', cost: 7, symbol: 'üëπ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ ÏµúÎã§ Ïãú +10Ï†ê', score: (g) => 10, chest: 0 },
            { id: 'enderman', name: 'ÏóîÎçîÎß®', emoji: 'üë§', cost: 5, symbol: 'üëπ', instant: '+2 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 2, endgame: 'Í∏∞Î≥∏ 4Ï†ê', score: () => 4, chest: 1 },
            
            // Íµ¨Ï°∞Î¨º (8Ïû•)
            { id: 'mineshaft', name: 'ÌèêÍ¥ë', emoji: 'üöÉ', cost: 4, symbol: 'üè†', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Ìñâ/Ïó¥ ‚õèÔ∏è 3Í∞ú Ïãú +6Ï†ê', score: (g, pos) => (countInRow(g, pos, '‚õèÔ∏è') >= 3 || countInColumn(g, pos, '‚õèÔ∏è') >= 3) ? 6 : 0, chest: 2 },
            { id: 'mineshaft2', name: 'ÌèêÍ¥ë', emoji: 'üöÉ', cost: 4, symbol: 'üè†', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Ìñâ/Ïó¥ ‚õèÔ∏è 3Í∞ú Ïãú +6Ï†ê', score: (g, pos) => (countInRow(g, pos, '‚õèÔ∏è') >= 3 || countInColumn(g, pos, '‚õèÔ∏è') >= 3) ? 6 : 0, chest: 2 },
            { id: 'dungeon', name: 'ÎçòÏ†Ñ', emoji: 'üè∞', cost: 3, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üëπ'), chest: 2 },
            { id: 'dungeon2', name: 'ÎçòÏ†Ñ', emoji: 'üè∞', cost: 3, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üëπ'), chest: 2 },
            { id: 'ancient_city', name: 'Í≥†ÎåÄ ÎèÑÏãú', emoji: 'üèõÔ∏è', cost: 6, symbol: 'üè†', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'üè† 1Í∞úÎãπ +2Ï†ê', score: (g) => countSymbol(g, 'üè†') * 2, chest: 4 },
            { id: 'lava_lake', name: 'Ïö©Ïïî Ìò∏Ïàò', emoji: 'üî•', cost: 2, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ïù∏Ï†ë Ïπ¥Îìú ÏóÜÏúºÎ©¥ +5Ï†ê', score: (g, pos) => countAdjacent(g, pos, null) === 0 ? 5 : 0, chest: 0 },
            { id: 'stronghold', name: 'ÏöîÏÉà', emoji: 'üèØ', cost: 5, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'ÏΩîÎÑà Î∞∞Ïπò Ïãú +6Ï†ê', score: (g, pos) => [0,2,6,8].includes(pos) ? 6 : 0, chest: 3 },
            { id: 'amethyst', name: 'ÏûêÏàòÏ†ï ÎèôÍµ¥', emoji: 'üíú', cost: 3, symbol: 'üè†', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 2 },
            
            // ÎèÑÍµ¨/Ïû•ÎπÑ (9Ïû•)
            { id: 'diamond_pick', name: 'Îã§Ïù¥ÏïÑ Í≥°Í¥≠Ïù¥', emoji: '‚õèÔ∏è', cost: 6, symbol: 'üîß', instant: 'Îã§Ïùå Íµ¨Îß§ -2', instantEffect: (g) => g.discount = 2, endgame: 'üîß ÏÑ∏Ìä∏Îãπ +3Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üîß') / 3) * 3, chest: 2 },
            { id: 'diamond_pick2', name: 'Îã§Ïù¥ÏïÑ Í≥°Í¥≠Ïù¥', emoji: '‚õèÔ∏è', cost: 6, symbol: 'üîß', instant: 'Îã§Ïùå Íµ¨Îß§ -2', instantEffect: (g) => g.discount = 2, endgame: 'üîß ÏÑ∏Ìä∏Îãπ +3Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üîß') / 3) * 3, chest: 2 },
            { id: 'iron_sword', name: 'Ï≤† Í≤Ä', emoji: 'üó°Ô∏è', cost: 3, symbol: 'üîß', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üëπ'), chest: 1 },
            { id: 'iron_sword2', name: 'Ï≤† Í≤Ä', emoji: 'üó°Ô∏è', cost: 3, symbol: 'üîß', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üëπ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üëπ'), chest: 1 },
            { id: 'torch', name: 'ÌöÉÎ∂à', emoji: 'üî¶', cost: 1, symbol: 'üîß', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'torch2', name: 'ÌöÉÎ∂à', emoji: 'üî¶', cost: 1, symbol: 'üîß', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'bucket', name: 'ÏñëÎèôÏù¥', emoji: 'ü™£', cost: 2, symbol: 'üîß', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'Í∏∞Î≥∏ 0Ï†ê', score: () => 0, chest: 1 },
            { id: 'shield', name: 'Î∞©Ìå®', emoji: 'üõ°Ô∏è', cost: 4, symbol: 'üîß', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ï§ëÏïô Î∞∞Ïπò Ïãú +5Ï†ê', score: (g, pos) => pos === 4 ? 5 : 0, chest: 2 },
            { id: 'bow', name: 'Ìôú', emoji: 'üèπ', cost: 3, symbol: 'üîß', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'ÎåÄÍ∞ÅÏÑ† üëπÎãπ +2Ï†ê', score: (g, pos) => countDiagonal(g, pos, 'üëπ') * 2, chest: 1 },
        ];
        
        const SURFACE_CARDS = [
            // Î∞îÏù¥Ïò¥/ÎÇòÎ¨¥ (12Ïû•)
            { id: 'oak', name: 'Ï∞∏ÎÇòÎ¨¥', emoji: 'üå≥', cost: 2, symbol: 'üå≤', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ìñâ üå≤Îãπ +1Ï†ê', score: (g, pos) => countInRow(g, pos, 'üå≤'), chest: 1 },
            { id: 'oak2', name: 'Ï∞∏ÎÇòÎ¨¥', emoji: 'üå≥', cost: 2, symbol: 'üå≤', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ìñâ üå≤Îãπ +1Ï†ê', score: (g, pos) => countInRow(g, pos, 'üå≤'), chest: 1 },
            { id: 'birch', name: 'ÏûêÏûëÎÇòÎ¨¥', emoji: 'üå¥', cost: 2, symbol: 'üå≤', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ïó¥ üå≤Îãπ +1Ï†ê', score: (g, pos) => countInColumn(g, pos, 'üå≤'), chest: 1 },
            { id: 'birch2', name: 'ÏûêÏûëÎÇòÎ¨¥', emoji: 'üå¥', cost: 2, symbol: 'üå≤', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ïó¥ üå≤Îãπ +1Ï†ê', score: (g, pos) => countInColumn(g, pos, 'üå≤'), chest: 1 },
            { id: 'spruce', name: 'Í∞ÄÎ¨∏ÎπÑÎÇòÎ¨¥', emoji: 'üå≤', cost: 2, symbol: 'üå≤', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üå≤ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üå≤') / 2) * 2, chest: 1 },
            { id: 'spruce2', name: 'Í∞ÄÎ¨∏ÎπÑÎÇòÎ¨¥', emoji: 'üå≤', cost: 2, symbol: 'üå≤', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üå≤ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üå≤') / 2) * 2, chest: 1 },
            { id: 'cherry', name: 'Î≤öÎÇòÎ¨¥', emoji: 'üå∏', cost: 3, symbol: 'üå≤', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 2 },
            { id: 'cherry2', name: 'Î≤öÎÇòÎ¨¥', emoji: 'üå∏', cost: 3, symbol: 'üå≤', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 2 },
            { id: 'jungle', name: 'Ï†ïÍ∏ÄÎÇòÎ¨¥', emoji: 'üéã', cost: 3, symbol: 'üå≤', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üêÑ'), chest: 1 },
            { id: 'jungle2', name: 'Ï†ïÍ∏ÄÎÇòÎ¨¥', emoji: 'üéã', cost: 3, symbol: 'üå≤', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üêÑ'), chest: 1 },
            { id: 'desert', name: 'ÏÇ¨Îßâ', emoji: 'üèúÔ∏è', cost: 1, symbol: 'üå≤', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'Í∏∞Î≥∏ 0Ï†ê', score: () => 0, chest: 0 },
            { id: 'mushroom', name: 'Î≤ÑÏÑØ ÏÑ¨', emoji: 'üçÑ', cost: 4, symbol: 'üå≤', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üå≤ 4Í∞ú+ Ïãú +6Ï†ê', score: (g) => countSymbol(g, 'üå≤') >= 4 ? 6 : 0, chest: 2 },
            
            // ÎèôÎ¨º (12Ïû•)
            { id: 'pig', name: 'ÎèºÏßÄ', emoji: 'üê∑', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üêÑ') / 2) * 2, chest: 0 },
            { id: 'pig2', name: 'ÎèºÏßÄ', emoji: 'üê∑', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üêÑ') / 2) * 2, chest: 0 },
            { id: 'cow', name: 'ÏÜå', emoji: 'üêÑ', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üêÑ') / 2) * 2, chest: 0 },
            { id: 'cow2', name: 'ÏÜå', emoji: 'üêÑ', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ ÏåçÎãπ +2Ï†ê', score: (g) => Math.floor(countSymbol(g, 'üêÑ') / 2) * 2, chest: 0 },
            { id: 'sheep', name: 'Ïñë', emoji: 'üêë', cost: 1, symbol: 'üêÑ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'sheep2', name: 'Ïñë', emoji: 'üêë', cost: 1, symbol: 'üêÑ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'chicken', name: 'Îã≠', emoji: 'üêî', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üåæ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üåæ'), chest: 0 },
            { id: 'chicken2', name: 'Îã≠', emoji: 'üêî', cost: 1, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üåæ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üåæ'), chest: 0 },
            { id: 'wolf', name: 'ÎäëÎåÄ', emoji: 'üê∫', cost: 3, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ïù∏Ï†ë üêÑÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üêÑ') * 2, chest: 1 },
            { id: 'wolf2', name: 'ÎäëÎåÄ', emoji: 'üê∫', cost: 3, symbol: 'üêÑ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ïù∏Ï†ë üêÑÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üêÑ') * 2, chest: 1 },
            { id: 'bee', name: 'Î≤å', emoji: 'üêù', cost: 2, symbol: 'üêÑ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Ïù∏Ï†ë üå≤Îãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üå≤') * 2, chest: 0 },
            { id: 'cat', name: 'Í≥†ÏñëÏù¥', emoji: 'üê±', cost: 2, symbol: 'üêÑ', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            
            // ÎßàÏùÑ (10Ïû•)
            { id: 'farmer', name: 'ÎÜçÎ∂Ä Ï£ºÎØº', emoji: 'üë®‚Äçüåæ', cost: 2, symbol: 'üë•', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Ïù∏Ï†ë üåæÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üåæ') * 2, chest: 1 },
            { id: 'farmer2', name: 'ÎÜçÎ∂Ä Ï£ºÎØº', emoji: 'üë®‚Äçüåæ', cost: 2, symbol: 'üë•', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Ïù∏Ï†ë üåæÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üåæ') * 2, chest: 1 },
            { id: 'librarian', name: 'ÏÇ¨ÏÑú Ï£ºÎØº', emoji: 'üìö', cost: 3, symbol: 'üë•', instant: '+1 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 1, endgame: 'üë• 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üë•'), chest: 2 },
            { id: 'blacksmith', name: 'ÎåÄÏû•Ïû•Ïù¥', emoji: 'üî®', cost: 3, symbol: 'üë•', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üîß 1Í∞úÎãπ +2Ï†ê', score: (g) => countSymbol(g, 'üîß') * 2, chest: 2 },
            { id: 'cleric', name: 'ÏÑ±ÏßÅÏûê', emoji: '‚õ™', cost: 4, symbol: 'üë•', instant: '+2 ÏßÑÏ£º', instantEffect: (g) => g.pearls += 2, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 2 },
            { id: 'golem', name: 'Ï≤† Í≥®Î†ò', emoji: 'ü§ñ', cost: 4, symbol: 'üë•', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üè† 2Í∞ú+ Ïãú +4Ï†ê', score: (g) => countSymbol(g, 'üè†') >= 2 ? 4 : 0, chest: 2 },
            { id: 'golem2', name: 'Ï≤† Í≥®Î†ò', emoji: 'ü§ñ', cost: 4, symbol: 'üë•', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üè† 2Í∞ú+ Ïãú +4Ï†ê', score: (g) => countSymbol(g, 'üè†') >= 2 ? 4 : 0, chest: 2 },
            { id: 'house', name: 'ÎßàÏùÑ Ïßë', emoji: 'üè†', cost: 3, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üë• 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üë•'), chest: 3 },
            { id: 'house2', name: 'ÎßàÏùÑ Ïßë', emoji: 'üè†', cost: 3, symbol: 'üè†', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üë• 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üë•'), chest: 3 },
            { id: 'well', name: 'Ïö∞Î¨º', emoji: 'ü™£', cost: 2, symbol: 'üè†', instant: '+2 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 2, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 1 },
            
            // ÎÜçÏûëÎ¨º/ÏûêÏõê (15Ïû•)
            { id: 'wheat', name: 'Î∞Ä', emoji: 'üåæ', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üåæ 4Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, 'üåæ') >= 4 ? 5 : 0, chest: 0 },
            { id: 'wheat2', name: 'Î∞Ä', emoji: 'üåæ', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üåæ 4Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, 'üåæ') >= 4 ? 5 : 0, chest: 0 },
            { id: 'wheat3', name: 'Î∞Ä', emoji: 'üåæ', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üåæ 4Í∞ú+ Ïãú +5Ï†ê', score: (g) => countSymbol(g, 'üåæ') >= 4 ? 5 : 0, chest: 0 },
            { id: 'carrot', name: 'ÎãπÍ∑º', emoji: 'ü•ï', cost: 1, symbol: 'üåæ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'carrot2', name: 'ÎãπÍ∑º', emoji: 'ü•ï', cost: 1, symbol: 'üåæ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∏∞Î≥∏ 1Ï†ê', score: () => 1, chest: 0 },
            { id: 'potato', name: 'Í∞êÏûê', emoji: 'ü•î', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üêÑ'), chest: 0 },
            { id: 'potato2', name: 'Í∞êÏûê', emoji: 'ü•î', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üêÑ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üêÑ'), chest: 0 },
            { id: 'sugarcane', name: 'ÏÇ¨ÌÉïÏàòÏàò', emoji: 'üéã', cost: 2, symbol: 'üåæ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ìñâ üåæÎãπ +1Ï†ê', score: (g, pos) => countInRow(g, pos, 'üåæ'), chest: 0 },
            { id: 'sugarcane2', name: 'ÏÇ¨ÌÉïÏàòÏàò', emoji: 'üéã', cost: 2, symbol: 'üåæ', instant: '+1 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 1, endgame: 'Í∞ôÏùÄ Ìñâ üåæÎãπ +1Ï†ê', score: (g, pos) => countInRow(g, pos, 'üåæ'), chest: 0 },
            { id: 'log', name: 'ÏõêÎ™©', emoji: 'ü™µ', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üå≤ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üå≤'), chest: 0 },
            { id: 'log2', name: 'ÏõêÎ™©', emoji: 'ü™µ', cost: 1, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'üå≤ 1Í∞úÎãπ +1Ï†ê', score: (g) => countSymbol(g, 'üå≤'), chest: 0 },
            { id: 'cobble', name: 'Ï°∞ÏïΩÎèå', emoji: 'ü™®', cost: 0, symbol: 'üåæ', instant: '+3 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 3, endgame: 'Í∏∞Î≥∏ 0Ï†ê', score: () => 0, chest: 0 },
            { id: 'cobble2', name: 'Ï°∞ÏïΩÎèå', emoji: 'ü™®', cost: 0, symbol: 'üåæ', instant: '+3 ÏóêÎ©îÎûÑÎìú', instantEffect: (g) => g.emeralds += 3, endgame: 'Í∏∞Î≥∏ 0Ï†ê', score: () => 0, chest: 0 },
            { id: 'melon', name: 'ÏàòÎ∞ï', emoji: 'üçâ', cost: 2, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Ïù∏Ï†ë üåæÎãπ +2Ï†ê', score: (g, pos) => countAdjacent(g, pos, 'üåæ') * 2, chest: 1 },
            { id: 'pumpkin', name: 'Ìò∏Î∞ï', emoji: 'üéÉ', cost: 2, symbol: 'üåæ', instant: 'ÏóÜÏùå', instantEffect: () => {}, endgame: 'Í∏∞Î≥∏ 2Ï†ê', score: () => 2, chest: 1 },
        ];
        
        // Í≤åÏûÑ ÏÉÅÌÉú
        let gameState = {
            emeralds: 15,
            pearls: 2,
            turn: 1,
            minecartLocation: 'surface', // 'cave' or 'surface'
            tableau: Array(9).fill(null),
            caveDeck: [],
            surfaceDeck: [],
            caveMarket: [],
            surfaceMarket: [],
            selectedCard: null,
            flipMode: false,
            discount: 0
        };
        
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        function countSymbol(g, symbol) {
            return g.tableau.filter(c => c && !c.flipped && c.symbol === symbol).length;
        }
        
        function countAdjacent(g, pos, symbol) {
            const adjacents = [
                pos - 3, // ÏúÑ
                pos + 3, // ÏïÑÎûò
                pos % 3 !== 0 ? pos - 1 : -1, // ÏôºÏ™Ω
                pos % 3 !== 2 ? pos + 1 : -1  // Ïò§Î•∏Ï™Ω
            ].filter(p => p >= 0 && p < 9);
            
            return adjacents.filter(p => {
                const card = g.tableau[p];
                if (!card || card.flipped) return false;
                return symbol === null || card.symbol === symbol;
            }).length;
        }
        
        function countInRow(g, pos, symbol) {
            const row = Math.floor(pos / 3);
            let count = 0;
            for (let i = row * 3; i < row * 3 + 3; i++) {
                const card = g.tableau[i];
                if (card && !card.flipped && card.symbol === symbol) count++;
            }
            return count;
        }
        
        function countInColumn(g, pos, symbol) {
            const col = pos % 3;
            let count = 0;
            for (let i = col; i < 9; i += 3) {
                const card = g.tableau[i];
                if (card && !card.flipped && card.symbol === symbol) count++;
            }
            return count;
        }
        
        function countDiagonal(g, pos, symbol) {
            const diagonals = [];
            const row = Math.floor(pos / 3);
            const col = pos % 3;
            
            if (row > 0 && col > 0) diagonals.push(pos - 4);
            if (row > 0 && col < 2) diagonals.push(pos - 2);
            if (row < 2 && col > 0) diagonals.push(pos + 2);
            if (row < 2 && col < 2) diagonals.push(pos + 4);
            
            return diagonals.filter(p => {
                const card = g.tableau[p];
                return card && !card.flipped && card.symbol === symbol;
            }).length;
        }
        
        function getValidPlacements() {
            const valid = [];
            const hasCards = gameState.tableau.some(c => c !== null);
            
            if (!hasCards) {
                return [0, 1, 2, 3, 4, 5, 6, 7, 8];
            }
            
            for (let i = 0; i < 9; i++) {
                if (gameState.tableau[i] !== null) continue;
                
                const adjacents = [
                    i - 3,
                    i + 3,
                    i % 3 !== 0 ? i - 1 : -1,
                    i % 3 !== 2 ? i + 1 : -1
                ];
                
                const hasAdjacentCard = adjacents.some(p => p >= 0 && p < 9 && gameState.tableau[p] !== null);
                if (hasAdjacentCard) valid.push(i);
            }
            
            return valid;
        }
        
        function calculateScore() {
            let total = 0;
            const breakdown = [];
            
            gameState.tableau.forEach((card, pos) => {
                if (card && !card.flipped) {
                    const cardScore = card.score(gameState, pos);
                    total += cardScore;
                    if (cardScore > 0) {
                        breakdown.push({ name: card.name, score: cardScore });
                    }
                }
            });
            
            // ÎÇ®ÏùÄ ÏßÑÏ£º Ï†êÏàò
            const pearlScore = gameState.pearls;
            total += pearlScore;
            if (pearlScore > 0) {
                breakdown.push({ name: 'ÎÇ®ÏùÄ ÏßÑÏ£º', score: pearlScore });
            }
            
            // ÏÉÅÏûêÏóê Ï†ÄÏû•Îêú ÏóêÎ©îÎûÑÎìú
            let chestCapacity = 0;
            gameState.tableau.forEach(card => {
                if (card && !card.flipped) {
                    chestCapacity += card.chest || 0;
                }
            });
            const storedEmeralds = Math.min(gameState.emeralds, chestCapacity);
            total += storedEmeralds;
            if (storedEmeralds > 0) {
                breakdown.push({ name: 'ÏÉÅÏûê ÏóêÎ©îÎûÑÎìú', score: storedEmeralds });
            }
            
            return { total, breakdown };
        }
        
        function renderCard(card, market, index) {
            const cardClass = market === 'cave' ? 'cave-card' : 'surface-card';
            return `
                <div class="card ${cardClass}" onclick="selectCard('${market}', ${index})">
                    <div class="card-cost">${card.cost}</div>
                    <div class="card-symbol">${card.symbol}</div>
                    <div class="card-image">${card.emoji}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-effect">
                        <div class="instant">‚ö° ${card.instant}</div>
                        <div class="endgame">üèÜ ${card.endgame}</div>
                    </div>
                    ${card.chest > 0 ? `<div class="card-chest">üì¶${card.chest}</div>` : ''}
                </div>
            `;
        }
        
        function renderTableauCard(card, pos) {
            if (card.flipped) {
                return `
                    <div class="card flipped">
                        <div class="card-image">ü™®</div>
                    </div>
                `;
            }
            
            const cardClass = gameState.caveDeck.some(c => c.id === card.id) ? 'cave-card' : 'surface-card';
            return `
                <div class="card ${cardClass}">
                    <div class="card-cost">${card.cost}</div>
                    <div class="card-symbol">${card.symbol}</div>
                    <div class="card-image">${card.emoji}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-effect">
                        <div class="instant">‚ö° ${card.instant}</div>
                        <div class="endgame">üèÜ ${card.endgame}</div>
                    </div>
                    ${card.chest > 0 ? `<div class="card-chest">üì¶${card.chest}</div>` : ''}
                </div>
            `;
        }
        
        function render() {
            // ÎßàÏºì Î†åÎçîÎßÅ
            document.getElementById('cave-market').innerHTML = 
                gameState.caveMarket.map((card, i) => renderCard(card, 'cave', i)).join('');
            document.getElementById('surface-market').innerHTML = 
                gameState.surfaceMarket.map((card, i) => renderCard(card, 'surface', i)).join('');
            
            // Í¥ëÏÇ∞ÏàòÎ†à ÏúÑÏπò
            document.getElementById('minecart-cave').style.display = 
                gameState.minecartLocation === 'cave' ? 'block' : 'none';
            document.getElementById('minecart-surface').style.display = 
                gameState.minecartLocation === 'surface' ? 'block' : 'none';
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏûêÏõê
            document.getElementById('emerald-count').textContent = gameState.emeralds;
            document.getElementById('pearl-count').textContent = gameState.pearls;
            document.getElementById('turn-count').textContent = gameState.turn;
            
            // ÌòÑÏû¨ Ï†êÏàò
            const { total } = calculateScore();
            document.getElementById('current-score').textContent = total + 'Ï†ê';
            
            // ÌÉÄÎ∏îÎ°ú Î†åÎçîÎßÅ
            const validPlacements = gameState.selectedCard ? getValidPlacements() : [];
            document.getElementById('player-tableau').innerHTML = gameState.tableau.map((card, i) => {
                if (card) {
                    return `<div class="tableau-slot has-card">${renderTableauCard(card, i)}</div>`;
                } else {
                    const isValid = validPlacements.includes(i);
                    return `<div class="tableau-slot ${isValid ? 'valid-placement' : ''}" 
                                onclick="${isValid ? `placeCard(${i})` : ''}">?</div>`;
                }
            }).join('');
            
            // Î≤ÑÌäº ÏÉÅÌÉú
            document.getElementById('btn-move-minecart').disabled = gameState.pearls < 1;
            document.getElementById('btn-refresh').disabled = gameState.pearls < 1;
            document.getElementById('btn-flip').classList.toggle('active', gameState.flipMode);
            
            // Î∞∞Ïπò ÌûåÌä∏
            document.getElementById('placement-hint').classList.toggle('active', gameState.selectedCard !== null);
        }
        
        function addLog(message) {
            const log = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[ÌÑ¥ ${gameState.turn}] ${message}`;
            log.insertBefore(entry, log.firstChild);
        }
        
        function selectCard(market, index) {
            const isCorrectMarket = gameState.minecartLocation === market;
            if (!isCorrectMarket) {
                addLog('Í¥ëÏÇ∞ÏàòÎ†àÍ∞Ä ÏûàÎäî ÎßàÏºìÏóêÏÑúÎßå Íµ¨Îß§ Í∞ÄÎä•!');
                return;
            }
            
            const cards = market === 'cave' ? gameState.caveMarket : gameState.surfaceMarket;
            const card = cards[index];
            const cost = Math.max(0, card.cost - gameState.discount);
            
            if (gameState.flipMode) {
                // Ï°∞ÏïΩÎèå Î≥ÄÌôò
                gameState.selectedCard = { ...card, flipped: true, market, index };
                addLog(`${card.name} ÏÑ†ÌÉù (Ï°∞ÏïΩÎèåÎ°ú Î≥ÄÌôò)`);
            } else {
                if (gameState.emeralds < cost) {
                    addLog(`ÏóêÎ©îÎûÑÎìú Î∂ÄÏ°±! (ÌïÑÏöî: ${cost}, Î≥¥Ïú†: ${gameState.emeralds})`);
                    return;
                }
                gameState.selectedCard = { ...card, market, index };
                addLog(`${card.name} ÏÑ†ÌÉù (ÎπÑÏö©: ${cost})`);
            }
            
            render();
        }
        
        function placeCard(position) {
            if (!gameState.selectedCard) return;
            
            const card = gameState.selectedCard;
            const cost = Math.max(0, card.cost - gameState.discount);
            
            if (card.flipped) {
                // Ï°∞ÏïΩÎèå Î≥ÄÌôò Î≥¥ÏÉÅ
                gameState.emeralds += 4;
                gameState.pearls += 2;
                addLog(`Ï°∞ÏïΩÎèå Î≥ÄÌôò: +4 ÏóêÎ©îÎûÑÎìú, +2 ÏßÑÏ£º`);
            } else {
                // ÏùºÎ∞ò Íµ¨Îß§
                gameState.emeralds -= cost;
                gameState.discount = 0;
                
                // Ï¶âÏãú Ìö®Í≥º Î∞úÎèô
                card.instantEffect(gameState);
                if (card.instant !== 'ÏóÜÏùå') {
                    addLog(`${card.name} Ìö®Í≥º: ${card.instant}`);
                }
            }
            
            // Ïπ¥Îìú Î∞∞Ïπò
            gameState.tableau[position] = card;
            
            // ÎßàÏºìÏóêÏÑú Ï†úÍ±∞ Î∞è Î≥¥Ï∂©
            if (card.market === 'cave') {
                gameState.caveMarket.splice(card.index, 1);
                if (gameState.caveDeck.length > 0) {
                    gameState.caveMarket.push(gameState.caveDeck.pop());
                }
            } else {
                gameState.surfaceMarket.splice(card.index, 1);
                if (gameState.surfaceDeck.length > 0) {
                    gameState.surfaceMarket.push(gameState.surfaceDeck.pop());
                }
            }
            
            gameState.selectedCard = null;
            gameState.flipMode = false;
            gameState.turn++;
            
            // Í≤åÏûÑ Ï¢ÖÎ£å Ï≤¥ÌÅ¨
            if (gameState.turn > 9) {
                endGame();
            } else {
                render();
            }
        }
        
        function moveMinecart() {
            if (gameState.pearls < 1) return;
            
            gameState.pearls--;
            gameState.minecartLocation = gameState.minecartLocation === 'cave' ? 'surface' : 'cave';
            addLog(`Í¥ëÏÇ∞ÏàòÎ†à Ïù¥Îèô ‚Üí ${gameState.minecartLocation === 'cave' ? 'ÎèôÍµ¥' : 'ÏßÄÏÉÅ'}`);
            render();
        }
        
        function refreshMarket() {
            if (gameState.pearls < 1) return;
            
            gameState.pearls--;
            
            if (gameState.minecartLocation === 'cave') {
                // ÌòÑÏû¨ ÎßàÏºì Ïπ¥ÎìúÎ•º Îç± Î∞ëÏúºÎ°ú
                gameState.caveDeck.unshift(...gameState.caveMarket);
                gameState.caveMarket = [];
                // ÏÉà Ïπ¥Îìú 3Ïû•
                for (let i = 0; i < 3 && gameState.caveDeck.length > 0; i++) {
                    gameState.caveMarket.push(gameState.caveDeck.pop());
                }
                addLog('ÎèôÍµ¥ ÎßàÏºì Î¶¨ÌîÑÎ†àÏãú');
            } else {
                gameState.surfaceDeck.unshift(...gameState.surfaceMarket);
                gameState.surfaceMarket = [];
                for (let i = 0; i < 3 && gameState.surfaceDeck.length > 0; i++) {
                    gameState.surfaceMarket.push(gameState.surfaceDeck.pop());
                }
                addLog('ÏßÄÏÉÅ ÎßàÏºì Î¶¨ÌîÑÎ†àÏãú');
            }
            
            render();
        }
        
        function toggleFlipMode() {
            gameState.flipMode = !gameState.flipMode;
            gameState.selectedCard = null;
            addLog(gameState.flipMode ? 'Ï°∞ÏïΩÎèå Î≥ÄÌôò Î™®Îìú ON' : 'Ï°∞ÏïΩÎèå Î≥ÄÌôò Î™®Îìú OFF');
            render();
        }
        
        function endGame() {
            const { total, breakdown } = calculateScore();
            
            document.getElementById('final-score').textContent = total + 'Ï†ê';
            document.getElementById('score-breakdown').innerHTML = breakdown.map(b => `
                <div class="score-row">
                    <span>${b.name}</span>
                    <span>+${b.score}Ï†ê</span>
                </div>
            `).join('');
            
            document.getElementById('game-over-modal').classList.add('active');
        }
        
        function newGame() {
            // Îç± Ï¥àÍ∏∞Ìôî Î∞è ÏÖîÌîå
            gameState = {
                emeralds: 15,
                pearls: 2,
                turn: 1,
                minecartLocation: 'surface',
                tableau: Array(9).fill(null),
                caveDeck: shuffle([...CAVE_CARDS]),
                surfaceDeck: shuffle([...SURFACE_CARDS]),
                caveMarket: [],
                surfaceMarket: [],
                selectedCard: null,
                flipMode: false,
                discount: 0
            };
            
            // ÎßàÏºì Ï±ÑÏö∞Í∏∞
            for (let i = 0; i < 3; i++) {
                gameState.caveMarket.push(gameState.caveDeck.pop());
                gameState.surfaceMarket.push(gameState.surfaceDeck.pop());
            }
            
            document.getElementById('game-over-modal').classList.remove('active');
            document.getElementById('game-log').innerHTML = '';
            addLog('ÏÉà Í≤åÏûÑ ÏãúÏûë!');
            render();
        }
        
        // Í≤åÏûÑ ÏãúÏûë
        newGame();
    </script>
</body>
</html>

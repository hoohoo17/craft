<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‘ë°”ì´ ì´ˆì½œë › ëŸ¬ì‹œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --chocolate: #4a2c2a;
      --chocolate-dark: #2d1b1a;
      --chocolate-light: #6b4423;
      --gold: #d4af37;
      --gold-light: #f4d03f;
      --cream: #f5e6d3;
      --cream-dark: #e8d4bc;
      --pistachio: #93c572;
      --lemon: #fff44f;
      --grapefruit: #ff6b6b;
      --kadaif: #daa520;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    #game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: none;
    }

    /* ì‹œì‘ í™”ë©´ */
    #start-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }

    #start-screen h1 {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 4rem;
      color: var(--chocolate);
      text-shadow: 4px 4px 0 var(--gold);
      margin-bottom: 20px;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #start-screen .subtitle {
      font-size: 1.5rem;
      color: var(--chocolate-light);
      margin-bottom: 40px;
    }

    .start-btn {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 2rem;
      padding: 20px 60px;
      background: linear-gradient(180deg, var(--gold-light) 0%, var(--gold) 100%);
      border: 4px solid var(--chocolate);
      border-radius: 20px;
      cursor: pointer;
      color: var(--chocolate);
      box-shadow: 0 6px 0 var(--chocolate-dark);
      transition: all 0.1s;
    }

    .start-btn:hover {
      transform: translateY(2px);
      box-shadow: 0 4px 0 var(--chocolate-dark);
    }

    .start-btn:active {
      transform: translateY(6px);
      box-shadow: 0 0 0 var(--chocolate-dark);
    }

    /* ì „ê´‘íŒ */
    #notification-bar {
      background: var(--chocolate-dark);
      color: var(--gold-light);
      padding: 15px 20px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
    }

    /* ìƒíƒœë°” */
    #status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--chocolate);
      color: var(--cream);
      padding: 15px 25px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-item .icon {
      font-size: 1.5rem;
    }

    /* ë©”ì¸ ê²Œì„ ì˜ì—­ */
    #game-area {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }

    /* ì†ë‹˜ ì˜ì—­ */
    #customer-section {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    #customer-section h2 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--chocolate);
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    #customer-queue {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .customer-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--cream);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      border: 3px solid transparent;
    }

    .customer-item:hover {
      background: var(--cream-dark);
    }

    .customer-item.selected {
      border-color: var(--gold);
      background: var(--gold-light);
    }

    .customer-icons {
      font-size: 1.5rem;
    }

    .customer-info {
      font-size: 0.9rem;
      color: var(--chocolate);
    }

    /* ì£¼ë¬¸ì„œ */
    #order-section {
      margin-top: 20px;
    }

    #order-section h3 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--chocolate);
      margin-bottom: 10px;
    }

    #order-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .order-item {
      padding: 10px;
      background: var(--cream);
      border-radius: 8px;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .order-item:hover {
      border-color: var(--chocolate-light);
    }

    .order-item.cooking {
      background: var(--gold-light);
      border-color: var(--gold);
    }

    .order-item.completed {
      background: var(--pistachio);
      opacity: 0.7;
    }

    .order-item.failed {
      background: var(--grapefruit);
      opacity: 0.7;
    }

    .order-status {
      font-size: 1.2rem;
    }

    /* ì¡°ë¦¬ëŒ€ ì˜ì—­ */
    #cooking-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    #cooking-section h2 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--chocolate);
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    /* ì¡°ë¦¬ ë‹¨ê³„ */
    #cooking-steps {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .cooking-step {
      flex: 1;
      min-width: 100px;
      padding: 15px 10px;
      background: var(--cream);
      border-radius: 10px;
      text-align: center;
      border: 3px solid transparent;
      transition: all 0.3s;
      cursor: pointer;
    }

    .cooking-step.completed {
      background: var(--pistachio);
      border-color: #5a9c3a;
    }

    .cooking-step.active {
      background: var(--gold-light);
      border-color: var(--gold);
      animation: pulse 1s infinite;
    }

    .cooking-step.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .step-icon {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    .step-name {
      font-size: 0.85rem;
      font-weight: bold;
      color: var(--chocolate);
    }

    .step-timer {
      font-size: 0.8rem;
      color: var(--chocolate-light);
      margin-top: 5px;
    }

    /* í† í•‘ ì„ íƒ */
    #topping-section {
      margin: 25px 0;
      padding: 20px;
      background: var(--cream);
      border-radius: 15px;
      display: none;
    }

    #topping-section.show {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #topping-section h3 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--chocolate);
      margin-bottom: 15px;
      text-align: center;
    }

    #topping-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .topping-btn {
      padding: 15px 25px;
      border: 3px solid var(--chocolate);
      border-radius: 15px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Noto Sans KR', sans-serif;
    }

    .topping-btn.kadaif {
      background: var(--kadaif);
      color: var(--chocolate-dark);
    }

    .topping-btn.lemon {
      background: var(--lemon);
      color: var(--chocolate-dark);
    }

    .topping-btn.grapefruit {
      background: var(--grapefruit);
      color: white;
    }

    .topping-btn:hover {
      transform: scale(1.1);
    }

    .topping-btn.selected {
      box-shadow: 0 0 0 4px var(--gold);
    }

    /* ì œê³µ ë²„íŠ¼ */
    #serve-section {
      text-align: center;
      margin-top: 25px;
    }

    #serve-btn {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 1.5rem;
      padding: 20px 50px;
      background: linear-gradient(180deg, var(--pistachio) 0%, #7ab55c 100%);
      border: 4px solid var(--chocolate);
      border-radius: 20px;
      cursor: pointer;
      color: var(--chocolate);
      box-shadow: 0 6px 0 var(--chocolate-dark);
      transition: all 0.1s;
      display: none;
    }

    #serve-btn.show {
      display: inline-block;
      animation: bounceIn 0.5s;
    }

    @keyframes bounceIn {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    #serve-btn:hover {
      transform: translateY(2px);
      box-shadow: 0 4px 0 var(--chocolate-dark);
    }

    #serve-btn:active {
      transform: translateY(6px);
      box-shadow: 0 0 0 var(--chocolate-dark);
    }

    /* ê²°ê³¼ íŒì—… */
    #result-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 40px 60px;
      border-radius: 20px;
      font-family: 'Black Han Sans', sans-serif;
      font-size: 3rem;
      z-index: 1000;
      display: none;
      animation: popIn 0.5s;
    }

    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    #result-popup.good {
      background: var(--pistachio);
      color: var(--chocolate);
      border: 5px solid #5a9c3a;
    }

    #result-popup.bad {
      background: var(--grapefruit);
      color: white;
      border: 5px solid #cc5555;
    }

    /* ì˜¤ë²„ë ˆì´ */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      display: none;
    }

    /* ì •ì‚° í™”ë©´ */
    #summary-screen {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      z-index: 1000;
      min-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    #summary-screen h2 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--chocolate);
      font-size: 2rem;
      margin-bottom: 20px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--cream-dark);
      font-size: 1.2rem;
    }

    .summary-total {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 2rem;
      color: var(--gold);
      margin-top: 20px;
    }

    #next-day-btn {
      margin-top: 30px;
      font-family: 'Black Han Sans', sans-serif;
      font-size: 1.3rem;
      padding: 15px 40px;
      background: var(--chocolate);
      color: var(--cream);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #next-day-btn:hover {
      background: var(--chocolate-light);
    }

    /* ê²Œì„ ì˜¤ë²„ í™”ë©´ */
    #gameover-screen {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(180deg, var(--chocolate) 0%, var(--chocolate-dark) 100%);
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      z-index: 1000;
      min-width: 500px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }

    #gameover-screen h2 {
      font-family: 'Black Han Sans', sans-serif;
      color: var(--gold);
      font-size: 2.5rem;
      margin-bottom: 30px;
    }

    #gameover-screen .final-stats {
      color: var(--cream);
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    #restart-btn {
      margin-top: 30px;
      font-family: 'Black Han Sans', sans-serif;
      font-size: 1.5rem;
      padding: 20px 50px;
      background: var(--gold);
      color: var(--chocolate);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #restart-btn:hover {
      background: var(--gold-light);
    }

    /* ë„ì›€ ì´ë²¤íŠ¸ */
    #help-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    #help-popup .chef-icon {
      font-size: 4rem;
      margin-bottom: 15px;
    }

    #help-popup p {
      font-size: 1.2rem;
      color: var(--chocolate);
      margin-bottom: 20px;
    }

    #help-popup button {
      font-family: 'Noto Sans KR', sans-serif;
      font-size: 1rem;
      padding: 10px 30px;
      background: var(--chocolate);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    /* ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ */
    .empty-message {
      color: #999;
      text-align: center;
      padding: 20px;
      font-style: italic;
    }

    /* ì§„í–‰ ë°” */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--cream-dark);
      border-radius: 4px;
      margin-top: 8px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gold);
      border-radius: 4px;
      transition: width 0.1s linear;
    }
  </style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="start-screen">
    <h1>ğŸ« ë‘ë°”ì´ ì´ˆì½œë › ëŸ¬ì‹œ ğŸ«</h1>
    <p class="subtitle">ë‹¬ì½¤í•œ ë‘ë°”ì´ ì´ˆì½œë › ê°€ê²Œë¥¼ ìš´ì˜í•˜ì„¸ìš”!</p>
    <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
  </div>

  <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
  <div id="game-container">
    <!-- ì „ê´‘íŒ -->
    <div id="notification-bar">ğŸ”” ê°€ê²Œ ì˜¤í”ˆ ì¤€ë¹„ ì¤‘...</div>

    <!-- ìƒíƒœë°” -->
    <div id="status-bar">
      <div class="status-item">
        <span class="icon">ğŸ“…</span>
        <span id="day-display">ì›”ìš”ì¼</span>
      </div>
      <div class="status-item">
        <span class="icon">ğŸ•</span>
        <span id="period-display">ì˜¤ì „</span>
      </div>
      <div class="status-item">
        <span class="icon">ğŸ’°</span>
        <span id="money-display">0ì›</span>
      </div>
      <div class="status-item">
        <span class="icon">ğŸ‘</span>
        <span id="good-display">0</span>
      </div>
      <div class="status-item">
        <span class="icon">ğŸ‘</span>
        <span id="bad-display">0</span>
      </div>
    </div>

    <!-- ë©”ì¸ ê²Œì„ ì˜ì—­ -->
    <div id="game-area">
      <!-- ì†ë‹˜ ì˜ì—­ -->
      <div id="customer-section">
        <h2>ğŸ‘¥ ëŒ€ê¸° ì†ë‹˜</h2>
        <div id="customer-queue"></div>

        <div id="order-section">
          <h3>ğŸ“‹ ì£¼ë¬¸ì„œ</h3>
          <div id="order-list"></div>
        </div>
      </div>

      <!-- ì¡°ë¦¬ëŒ€ ì˜ì—­ -->
      <div id="cooking-section">
        <h2>ğŸ³ ì¡°ë¦¬ëŒ€</h2>
        
        <div id="cooking-steps">
          <div class="cooking-step disabled" data-step="0">
            <div class="step-icon">ğŸ«</div>
            <div class="step-name">ì´ˆì½œë › ë…¹ì´ê¸°</div>
          </div>
          <div class="cooking-step disabled" data-step="1">
            <div class="step-icon">ğŸ«—</div>
            <div class="step-name">ëª°ë“œì— ë¶“ê¸°</div>
          </div>
          <div class="cooking-step disabled" data-step="2">
            <div class="step-icon">ğŸ§Š</div>
            <div class="step-name">ëƒ‰ë™ (10ì´ˆ)</div>
            <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
          </div>
          <div class="cooking-step disabled" data-step="3">
            <div class="step-icon">ğŸ³</div>
            <div class="step-name">í† í•‘ ë³¶ê¸° (5ì´ˆ)</div>
            <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
          </div>
          <div class="cooking-step disabled" data-step="4">
            <div class="step-icon">ğŸ¥£</div>
            <div class="step-name">í”¼ìŠ¤íƒ€ì¹˜ì˜¤ ì„ê¸°</div>
          </div>
          <div class="cooking-step disabled" data-step="5">
            <div class="step-icon">ğŸ§Š</div>
            <div class="step-name">ëƒ‰ë™ (10ì´ˆ)</div>
            <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
          </div>
        </div>

        <div id="topping-section">
          <h3>ğŸ¥œ í† í•‘ ì„ íƒ</h3>
          <div id="topping-buttons">
            <button class="topping-btn kadaif" onclick="selectTopping('kadaif')">ğŸ¥¨ ì¹´ë‹¤ì´í”„</button>
            <button class="topping-btn lemon" onclick="selectTopping('lemon')">ğŸ‹ ë ˆëª¬</button>
            <button class="topping-btn grapefruit" onclick="selectTopping('grapefruit')">ğŸŠ ìëª½</button>
          </div>
        </div>

        <div id="serve-section">
          <button id="serve-btn" onclick="serveOrder()">ğŸ« ì†ë‹˜ì—ê²Œ ì œê³µí•˜ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì˜¤ë²„ë ˆì´ -->
  <div id="overlay"></div>

  <!-- ê²°ê³¼ íŒì—… -->
  <div id="result-popup"></div>

  <!-- ì •ì‚° í™”ë©´ -->
  <div id="summary-screen">
    <h2>ğŸ“Š ì¼ì¼ ì •ì‚°</h2>
    <div id="summary-content"></div>
    <button id="next-day-btn" onclick="nextDay()">ë‹¤ìŒ ë‚ ë¡œ</button>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
  <div id="gameover-screen">
    <h2>ğŸ‰ í•œ ì£¼ ì™„ë£Œ!</h2>
    <div id="final-stats"></div>
    <button id="restart-btn" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
  </div>

  <!-- ë„ì›€ ì´ë²¤íŠ¸ íŒì—… -->
  <div id="help-popup">
    <div class="chef-icon">ğŸ‘¨â€ğŸ³</div>
    <p>ì¡°ë¦¬ì‚¬ê°€ ë„ì™€ì£¼ëŸ¬ ì™”ìŠµë‹ˆë‹¤!</p>
    <button onclick="closeHelpPopup()">í™•ì¸</button>
  </div>

  <script>
    // ===== ìƒìˆ˜ =====
    const CONFIG = {
      MENU: {
        kadaif: { name: 'ë‘ë°”ì´ ì´ˆì½œë ›', topping: 'kadaif', price: 5 },
        lemon: { name: 'ë ˆëª¬ ë‘ë°”ì´ ì´ˆì½œë ›', topping: 'lemon', price: 5 },
        grapefruit: { name: 'ìëª½ ë‘ë°”ì´ ì´ˆì½œë ›', topping: 'grapefruit', price: 5 }
      },

      TOPPING_NAMES: {
        kadaif: 'ì¹´ë‹¤ì´í”„',
        lemon: 'ë ˆëª¬',
        grapefruit: 'ìëª½'
      },

      TIMING: {
        FREEZE: 10000,
        FRY: 5000,
        HELP_EVENT: 180000
      },

      CUSTOMER_TYPES: [
        { type: 'solo', count: 1, orderMin: 1, orderMax: 1, weight: 30 },
        { type: 'couple', count: 2, orderMin: 1, orderMax: 2, weight: 25 },
        { type: 'family', count: 4, orderMin: 2, orderMax: 4, weight: 20 },
        { type: 'bigFamily', count: 6, orderMin: 3, orderMax: 6, weight: 15 },
        { type: 'group', count: 10, orderMin: 5, orderMax: 10, weight: 8 },
        { type: 'bigGroup', count: 12, orderMin: 6, orderMax: 12, weight: 2, rare: true }
      ],

      DAYS: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],

      DAY_SCHEDULE: {
        'ì›”': { am: { min: 3, max: 6 }, pm: { min: 3, max: 6 } },
        'í™”': { am: { min: 5, max: 8 }, pm: { min: 3, max: 5 } },
        'ìˆ˜': { am: { min: 6, max: 10 }, pm: { min: 6, max: 10 } },
        'ëª©': { am: { min: 3, max: 6 }, pm: { min: 3, max: 6 } },
        'ê¸ˆ': { am: { min: 1, max: 5 }, pm: { min: 15, max: 25 } },
        'í† ': { am: { min: 0, max: 0 }, pm: { min: 0, max: 0 } },
        'ì¼': { am: { min: 0, max: 0 }, pm: { min: 0, max: 0 } }
      },

      MENU_PROBABILITY: {
        am: { kadaif: 30, lemon: 50, grapefruit: 20 },
        pm: { kadaif: 60, lemon: 25, grapefruit: 15 }
      }
    };

    // ===== ê²Œì„ ìƒíƒœ =====
    let GameState = {
      currentDay: 0,
      currentPeriod: 'am',
      money: 0,
      customerQueue: [],
      currentCustomer: null,
      currentOrderIndex: null,
      cookingState: {
        active: false,
        step: 0,
        topping: null,
        timerStart: null,
        timerDuration: 0
      },
      stats: {
        goodCount: 0,
        badCount: 0,
        dayMoney: 0,
        dayGood: 0,
        dayBad: 0
      },
      bigGroupAppeared: false,
      orderStartTime: null,
      timerInterval: null,
      spawnedCustomersAM: false,
      spawnedCustomersPM: false
    };

    // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
    function random(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function weightedRandom(items, weightKey) {
      const totalWeight = items.reduce((sum, item) => sum + item[weightKey], 0);
      let random = Math.random() * totalWeight;
      
      for (const item of items) {
        random -= item[weightKey];
        if (random <= 0) return item;
      }
      return items[items.length - 1];
    }

    function getMenuByProbability(period) {
      const probs = CONFIG.MENU_PROBABILITY[period];
      const rand = Math.random() * 100;
      
      if (rand < probs.kadaif) return 'kadaif';
      if (rand < probs.kadaif + probs.lemon) return 'lemon';
      return 'grapefruit';
    }

    // ===== ì•Œë¦¼ =====
    function showNotification(message) {
      const bar = document.getElementById('notification-bar');
      bar.textContent = 'ğŸ”” ' + message;
      bar.style.animation = 'none';
      bar.offsetHeight;
      bar.style.animation = 'pulse 0.5s';
    }

    // ===== ì†ë‹˜ ìƒì„± =====
    function generateCustomers() {
      const day = CONFIG.DAYS[GameState.currentDay];
      const schedule = CONFIG.DAY_SCHEDULE[day][GameState.currentPeriod];
      
      if (schedule.max === 0) return;

      const customerCount = random(schedule.min, schedule.max);
      
      for (let i = 0; i < customerCount; i++) {
        const customer = createCustomer();
        if (customer) {
          GameState.customerQueue.push(customer);
        }
      }

      if (GameState.customerQueue.length > 0) {
        showNotification(`${GameState.customerQueue.length}ëª…ì˜ ì†ë‹˜ì´ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤!`);
      }

      renderCustomerQueue();
    }

    function createCustomer() {
      let availableTypes = CONFIG.CUSTOMER_TYPES.filter(t => {
        if (t.rare && GameState.bigGroupAppeared) return false;
        return true;
      });

      const type = weightedRandom(availableTypes, 'weight');
      
      if (type.rare) {
        GameState.bigGroupAppeared = true;
      }

      const orderCount = random(type.orderMin, type.orderMax);
      const orders = [];

      for (let i = 0; i < orderCount; i++) {
        orders.push({
          menu: getMenuByProbability(GameState.currentPeriod),
          status: 'pending'
        });
      }

      return {
        type: type.type,
        count: type.count,
        orders: orders,
        arrivalTime: Date.now()
      };
    }

    // ===== ë Œë”ë§ =====
    function renderCustomerQueue() {
      const container = document.getElementById('customer-queue');
      container.innerHTML = '';

      if (GameState.customerQueue.length === 0) {
        container.innerHTML = '<div class="empty-message">ëŒ€ê¸° ì¤‘ì¸ ì†ë‹˜ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      GameState.customerQueue.forEach((customer, index) => {
        const div = document.createElement('div');
        div.className = 'customer-item' + (GameState.currentCustomer === index ? ' selected' : '');
        
        const icons = 'ğŸ‘¤'.repeat(Math.min(customer.count, 6)) + (customer.count > 6 ? `+${customer.count - 6}` : '');
        const pendingOrders = customer.orders.filter(o => o.status === 'pending').length;
        
        div.innerHTML = `
          <div class="customer-icons">${icons}</div>
          <div class="customer-info">
            <div>${customer.count}ëª…</div>
            <div>ì£¼ë¬¸ ${pendingOrders}ê°œ ë‚¨ìŒ</div>
          </div>
        `;
        
        div.onclick = () => selectCustomer(index);
        container.appendChild(div);
      });
    }

    function renderOrderList() {
      const container = document.getElementById('order-list');
      container.innerHTML = '';

      if (GameState.currentCustomer === null) {
        container.innerHTML = '<div class="empty-message">ì†ë‹˜ì„ ì„ íƒí•˜ì„¸ìš”</div>';
        return;
      }

      const customer = GameState.customerQueue[GameState.currentCustomer];
      if (!customer) return;

      customer.orders.forEach((order, index) => {
        const div = document.createElement('div');
        div.className = 'order-item ' + order.status;
        
        const menuInfo = CONFIG.MENU[order.menu];
        let statusIcon = '';
        
        switch(order.status) {
          case 'pending': statusIcon = 'â³'; break;
          case 'cooking': statusIcon = 'ğŸ”¥'; break;
          case 'completed': statusIcon = 'âœ…'; break;
          case 'failed': statusIcon = 'âŒ'; break;
        }
        
        div.innerHTML = `
          <span>${menuInfo.name}</span>
          <span class="order-status">${statusIcon}</span>
        `;
        
        if (order.status === 'pending' && !GameState.cookingState.active) {
          div.onclick = () => startCooking(index);
        }
        
        container.appendChild(div);
      });
    }

    function renderCookingSteps() {
      const steps = document.querySelectorAll('.cooking-step');
      
      steps.forEach((stepEl, index) => {
        stepEl.classList.remove('completed', 'active', 'disabled');
        
        if (!GameState.cookingState.active) {
          stepEl.classList.add('disabled');
        } else if (index < GameState.cookingState.step) {
          stepEl.classList.add('completed');
        } else if (index === GameState.cookingState.step) {
          stepEl.classList.add('active');
        } else {
          stepEl.classList.add('disabled');
        }

        const progressBar = stepEl.querySelector('.progress-fill');
        if (progressBar) {
          progressBar.style.width = '0%';
        }
      });
    }

    function updateStatusBar() {
      document.getElementById('day-display').textContent = CONFIG.DAYS[GameState.currentDay] + 'ìš”ì¼';
      document.getElementById('period-display').textContent = GameState.currentPeriod === 'am' ? 'ì˜¤ì „' : 'ì˜¤í›„';
      document.getElementById('money-display').textContent = GameState.money + 'ì›';
      document.getElementById('good-display').textContent = GameState.stats.goodCount;
      document.getElementById('bad-display').textContent = GameState.stats.badCount;
    }

    // ===== ì†ë‹˜ ì„ íƒ =====
    function selectCustomer(index) {
      if (GameState.cookingState.active) return;
      
      GameState.currentCustomer = index;
      GameState.currentOrderIndex = null;
      
      renderCustomerQueue();
      renderOrderList();
    }

    // ===== ì¡°ë¦¬ ì‹œìŠ¤í…œ =====
    function startCooking(orderIndex) {
      if (GameState.cookingState.active) return;
      if (GameState.currentCustomer === null) return;

      const customer = GameState.customerQueue[GameState.currentCustomer];
      if (!customer || !customer.orders[orderIndex]) return;

      customer.orders[orderIndex].status = 'cooking';
      GameState.currentOrderIndex = orderIndex;
      GameState.orderStartTime = Date.now();

      GameState.cookingState = {
        active: true,
        step: 0,
        topping: null,
        timerStart: null,
        timerDuration: 0
      };

      showNotification('ì¡°ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!');
      renderOrderList();
      renderCookingSteps();
      setupStepClickHandlers();
    }

    function setupStepClickHandlers() {
      const steps = document.querySelectorAll('.cooking-step');
      
      steps.forEach((stepEl, index) => {
        stepEl.onclick = () => {
          if (!GameState.cookingState.active) return;
          if (index !== GameState.cookingState.step) return;
          
          advanceStep();
        };
      });
    }

    function advanceStep() {
      const currentStep = GameState.cookingState.step;
      
      // íƒ€ì´ë¨¸ ìŠ¤í…ì¸ ê²½ìš°
      if (currentStep === 2 || currentStep === 5) {
        // ëƒ‰ë™ 10ì´ˆ
        if (!GameState.cookingState.timerStart) {
          startTimer(CONFIG.TIMING.FREEZE);
          return;
        }
      } else if (currentStep === 3) {
        // í† í•‘ ë³¶ê¸° 5ì´ˆ
        if (!GameState.cookingState.topping) {
          document.getElementById('topping-section').classList.add('show');
          return;
        }
        if (!GameState.cookingState.timerStart) {
          startTimer(CONFIG.TIMING.FRY);
          return;
        }
      }

      // ë‹¤ìŒ ë‹¨ê³„ë¡œ
      GameState.cookingState.step++;
      GameState.cookingState.timerStart = null;
      GameState.cookingState.timerDuration = 0;

      if (GameState.cookingState.step >= 6) {
        completeCooking();
      } else {
        renderCookingSteps();
        
        if (GameState.cookingState.step === 3) {
          document.getElementById('topping-section').classList.add('show');
        }
      }
    }

    function startTimer(duration) {
      GameState.cookingState.timerStart = Date.now();
      GameState.cookingState.timerDuration = duration;

      const stepEl = document.querySelector(`.cooking-step[data-step="${GameState.cookingState.step}"]`);
      const progressFill = stepEl.querySelector('.progress-fill');

      if (GameState.timerInterval) {
        clearInterval(GameState.timerInterval);
      }

      GameState.timerInterval = setInterval(() => {
        const elapsed = Date.now() - GameState.cookingState.timerStart;
        const progress = Math.min((elapsed / duration) * 100, 100);
        
        if (progressFill) {
          progressFill.style.width = progress + '%';
        }

        if (elapsed >= duration) {
          clearInterval(GameState.timerInterval);
          GameState.timerInterval = null;
          advanceStep();
        }

        // 3ë¶„ ì´ˆê³¼ ì²´í¬
        checkHelpEvent();
      }, 100);
    }

    function selectTopping(topping) {
      if (GameState.cookingState.step !== 3) return;
      
      GameState.cookingState.topping = topping;
      
      document.querySelectorAll('.topping-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      document.querySelector(`.topping-btn.${topping}`).classList.add('selected');
      
      showNotification(`${CONFIG.TOPPING_NAMES[topping]}ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤!`);
      
      setTimeout(() => {
        document.getElementById('topping-section').classList.remove('show');
        advanceStep();
      }, 500);
    }

    function completeCooking() {
      GameState.cookingState.active = false;
      document.getElementById('serve-btn').classList.add('show');
      showNotification('ì¡°ë¦¬ ì™„ë£Œ! ì†ë‹˜ì—ê²Œ ì œê³µí•˜ì„¸ìš”!');
      renderCookingSteps();
    }

    function serveOrder() {
      if (GameState.currentCustomer === null || GameState.currentOrderIndex === null) return;

      const customer = GameState.customerQueue[GameState.currentCustomer];
      const order = customer.orders[GameState.currentOrderIndex];
      
      const isMatch = GameState.cookingState.topping === order.menu;

      if (isMatch) {
        order.status = 'completed';
        GameState.money += CONFIG.MENU[order.menu].price;
        GameState.stats.goodCount++;
        GameState.stats.dayGood++;
        GameState.stats.dayMoney += CONFIG.MENU[order.menu].price;
        showResult('good');
        showNotification('Good! +5ì›!');
      } else {
        order.status = 'failed';
        GameState.stats.badCount++;
        GameState.stats.dayBad++;
        showResult('bad');
        showNotification('Bad! ì£¼ë¬¸ê³¼ ë‹¤ë¦…ë‹ˆë‹¤!');
      }

      // ë¦¬ì…‹
      document.getElementById('serve-btn').classList.remove('show');
      document.getElementById('topping-section').classList.remove('show');
      document.querySelectorAll('.topping-btn').forEach(btn => btn.classList.remove('selected'));
      
      GameState.cookingState = {
        active: false,
        step: 0,
        topping: null,
        timerStart: null,
        timerDuration: 0
      };
      GameState.currentOrderIndex = null;

      // ì†ë‹˜ì˜ ëª¨ë“  ì£¼ë¬¸ ì™„ë£Œ ì²´í¬
      const pendingOrders = customer.orders.filter(o => o.status === 'pending').length;
      if (pendingOrders === 0) {
        setTimeout(() => {
          GameState.customerQueue.splice(GameState.currentCustomer, 1);
          GameState.currentCustomer = null;
          renderCustomerQueue();
          renderOrderList();
          checkPeriodEnd();
        }, 1500);
      } else {
        renderOrderList();
      }

      renderCookingSteps();
      updateStatusBar();
    }

    function showResult(type) {
      const popup = document.getElementById('result-popup');
      const overlay = document.getElementById('overlay');
      
      popup.className = type;
      popup.textContent = type === 'good' ? 'ğŸ‘ Good!' : 'ğŸ‘ Bad!';
      popup.style.display = 'block';
      overlay.style.display = 'block';

      setTimeout(() => {
        popup.style.display = 'none';
        overlay.style.display = 'none';
      }, 1000);
    }

    // ===== ì´ë²¤íŠ¸ =====
    function checkHelpEvent() {
      if (!GameState.orderStartTime) return;
      
      const elapsed = Date.now() - GameState.orderStartTime;
      if (elapsed >= CONFIG.TIMING.HELP_EVENT && !GameState.helpEventTriggered) {
        GameState.helpEventTriggered = true;
        showHelpEvent();
      }
    }

    function showHelpEvent() {
      document.getElementById('help-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function closeHelpPopup() {
      document.getElementById('help-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
      GameState.helpEventTriggered = false;
    }

    // ===== ê²Œì„ ì§„í–‰ =====
    function checkPeriodEnd() {
      if (GameState.customerQueue.length === 0) {
        if (GameState.currentPeriod === 'am') {
          GameState.currentPeriod = 'pm';
          showNotification('ì˜¤í›„ íƒ€ì„ ì‹œì‘!');
          updateStatusBar();
          generateCustomers();
        } else {
          endDay();
        }
      }
    }

    function endDay() {
      const day = CONFIG.DAYS[GameState.currentDay];
      
      if (day === 'í† ' || day === 'ì¼') {
        showSummary();
        return;
      }

      showSummary();
    }

    function showSummary() {
      const content = document.getElementById('summary-content');
      const day = CONFIG.DAYS[GameState.currentDay];
      
      content.innerHTML = `
        <div class="summary-item">
          <span>ì˜¤ëŠ˜ ìˆ˜ì…</span>
          <span>${GameState.stats.dayMoney}ì›</span>
        </div>
        <div class="summary-item">
          <span>Good</span>
          <span>${GameState.stats.dayGood}ê°œ</span>
        </div>
        <div class="summary-item">
          <span>Bad</span>
          <span>${GameState.stats.dayBad}ê°œ</span>
        </div>
        <div class="summary-total">
          ì´ ìˆ˜ì…: ${GameState.money}ì›
        </div>
      `;

      document.getElementById('summary-screen').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';

      const nextBtn = document.getElementById('next-day-btn');
      if (GameState.currentDay >= 6) {
        nextBtn.textContent = 'ê²°ê³¼ ë³´ê¸°';
      } else if (day === 'ê¸ˆ') {
        nextBtn.textContent = 'ì£¼ë§ íœ´ì‹';
      } else {
        nextBtn.textContent = 'ë‹¤ìŒ ë‚ ë¡œ';
      }
    }

    function nextDay() {
      document.getElementById('summary-screen').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';

      GameState.stats.dayMoney = 0;
      GameState.stats.dayGood = 0;
      GameState.stats.dayBad = 0;

      GameState.currentDay++;

      if (GameState.currentDay > 6) {
        showGameOver();
        return;
      }

      const day = CONFIG.DAYS[GameState.currentDay];

      if (day === 'í† ') {
        showNotification('í† ìš”ì¼ íœ´ë¬´ì…ë‹ˆë‹¤!');
        setTimeout(() => {
          showSummary();
        }, 1000);
        updateStatusBar();
        return;
      }

      if (day === 'ì¼') {
        showNotification('ì¼ìš”ì¼ íœ´ë¬´ì…ë‹ˆë‹¤! ì¥ë³´ëŸ¬ ê°€ì„¸ìš”!');
        setTimeout(() => {
          showSummary();
        }, 1000);
        updateStatusBar();
        return;
      }

      GameState.currentPeriod = 'am';
      showNotification(`${day}ìš”ì¼ ì˜¤ì „ ì‹œì‘!`);
      updateStatusBar();
      generateCustomers();
    }

    function showGameOver() {
      const stats = document.getElementById('final-stats');
      stats.innerHTML = `
        <div class="final-stats">ì´ ìˆ˜ì…: ${GameState.money}ì›</div>
        <div class="final-stats">ì´ Good: ${GameState.stats.goodCount}ê°œ</div>
        <div class="final-stats">ì´ Bad: ${GameState.stats.badCount}ê°œ</div>
      `;

      document.getElementById('gameover-screen').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function restartGame() {
      document.getElementById('gameover-screen').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('game-container').style.display = 'none';
      document.getElementById('start-screen').style.display = 'flex';

      // ìƒíƒœ ì´ˆê¸°í™”
      GameState = {
        currentDay: 0,
        currentPeriod: 'am',
        money: 0,
        customerQueue: [],
        currentCustomer: null,
        currentOrderIndex: null,
        cookingState: {
          active: false,
          step: 0,
          topping: null,
          timerStart: null,
          timerDuration: 0
        },
        stats: {
          goodCount: 0,
          badCount: 0,
          dayMoney: 0,
          dayGood: 0,
          dayBad: 0
        },
        bigGroupAppeared: false,
        orderStartTime: null,
        timerInterval: null
      };
    }

    // ===== ê²Œì„ ì‹œì‘ =====
    function startGame() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';

      GameState = {
        currentDay: 0,
        currentPeriod: 'am',
        money: 0,
        customerQueue: [],
        currentCustomer: null,
        currentOrderIndex: null,
        cookingState: {
          active: false,
          step: 0,
          topping: null,
          timerStart: null,
          timerDuration: 0
        },
        stats: {
          goodCount: 0,
          badCount: 0,
          dayMoney: 0,
          dayGood: 0,
          dayBad: 0
        },
        bigGroupAppeared: false,
        orderStartTime: null,
        timerInterval: null
      };

      updateStatusBar();
      renderCookingSteps();
      showNotification('ì›”ìš”ì¼ ì˜¤ì „! ê°€ê²Œê°€ ì—´ë ¸ìŠµë‹ˆë‹¤!');
      
      setTimeout(() => {
        generateCustomers();
      }, 1000);
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      renderCustomerQueue();
      renderOrderList();
      renderCookingSteps();
    });
  </script>
</body>
</html>
